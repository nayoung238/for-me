# IP 주소

IP (Internet Protocol) 주소는 Network 계층인 3계층에서 사용된다.<br>

- 사용자가 변경 가능한 논리 주소이고
- IP 주소는 그룹을 의미하는 네트워크 주소와 호스트 주소롤 나뉜다.

## IP 주소 체계

- 흔히 사용하는 IPv4는 32비트 주소공간을 제공한다.
- 주소 부족 문제를 해결하기 위해 생긴 IPv6는 128비트 주소공간을 제공한다.

32비트인 IPv4 주소를 표기할 때는 4개의 Octet 이라 부르는 8비트 단위로 나누고, 각 Octet는 . 으로 구분한다.<br>
IP주소는 10진수로 표기하기 때문에 Octet은 0부터 255까지의 값을 사용한다.<br>


IP주소는 32비트안에서 네트워크 주소와 호스트 주소로 나뉜다.<br> 

- 네트워크 주소 : 호스트들을 모은 네트워크를 지칭하는 주소
  - 로컬 네트워크 : 네트워크 주소가 동일한 네트워크
- 호스트 주소 : 하나의 네트워크 내에서 존재하는 호스트를 구분하기 위한 주소

24비트인 MAC주소는 12비트씩 OUI, UAA로 나눴지만, IP주소는 나누는 경계가 정해져 있지 않다.<br>

IP 주소체계는 필요한 호스트 IP 개수에 따라 네트워크의 크기를 다르게 할당할 수 있는 **class** 개념이 있다.<br>
고정된 체계가 아니므로 주소를 절약할 수 있다는 장점이 있고, 클래스 기반 IP 주소 체계를 Classful 이라고 한다.<br>

![png](/_img/ip_class.png) <br>
> 출처 : https://goodmilktea.tistory.com/96 <br>

### A 클래스

- 2^8 = 약 250개의 네트워크 주소와 2^24 = 약 1600만개의 IP 주소를 갖는다. 
- 즉, 한 네트워크 당 2^24 - 2개의 호스트 주소를 갖는다. (2를 뺀 이유 아래 설명)
- A 클래스는 2진수 8자리가 네트워크 주소인데 8자리 중 맨 앞자리가 0이다.
- 즉, 00000000(0) ~ 01111111(127) 까지가 네트워크 주소인데 127은 자신을 의미하는 Loopback 주소로 사용되므로 실제 사용할 수 있는 주소는 1.0.0.0 부터 126.255.255.255 까지다.

### B 클래스
 
- 2^16 = 약 6만 5천개의 네트워크 주소와 2^16 = 약 6만 5천개의 IP 주소를 갖는다.
- 즉, 한 네트워크 당 2^16 - 2개의 호스트 주소를 갖는다.
- 첫 Octet을 2진수로 표현했을 때 맨 앞자리가 1이고 두 번쨰 자리가 0이다.
- 즉, 10 000000(128) ~ 10 11111(191) 까지다.

### C 클래스

- 2^24 = 16,777,216개의 네트워크 주소와 2^8 = 약 250개의 IP 주소를 갖는다.
- 한 네트워크 당 2^8 - 2개의 호스트 주소를 갖는다.
- 첫 Octet을 2진수로 표현했을 때 맨 앞자리와 두 번째 자리가 1이고 세 번쨰자리가 0이다.
- 즉, 110 00000(192) ~ 110 11111(223) 까지다.

첫 Octet의 숫자를 보고 네트워크 주소와 IP주소를 구분할 수 있다.<br>

모든 클래스에서 한 네트워크 당 가질 수 있는 IP주소에서 2를 뺀 이유는 네트워크 주소, 브로드캐스트 주소 때문이다. IP 체계에서 맨 앞 숫자를 네트워크 주소로, 맨 뒤 숫자를 브로드캐스트 주소로 사용한다.<br>
하지만 클래스 기반 방법은 현재 사용되지 않고, 지금은 1비트 단위로 네트워크를 상세히 분할한다.<br><br>

## classless

Class 기반 IP 체계가 감당하기 어려울 정도로 IP 주소 요구가 기하급수적으로 일어나 이를 해결하기 위해 3가지 보존, 전환전략이 만들어졌다.

- CIDR(Classless Inter-Domain Routing)
- NAT와 사설 IP 주소
- IPv6

A 클래스의 경우 한 네트워크 당 2^24개의 IP 주소를 갖는데 이는 네트워크를 할당받은 조직만 사용가능하다. 즉, IP 주소가 남아도 다른 기관이 사용할 수 없어 낭비는 심해진다.<br>
낭비는 심해지고 요구되는 IP 주소는 늘어나는 것을 해결하고자 클래스 개념을 없앴는데 이를 Classless라고 하며 현재 우리가 사용하고 있는 방법이다.<br>

Class 기반은 첫 Octet을 보고 네트워크 주소와 IP 주소를 구분했다.<br>
클래스리스는 Class 개념을 버렸기 때문에 이를 구분하는 구분자를 사용해야 되는데 이를 **Subnet mask** 라고 한다.<br>

## 서브넷 마스크

1은 네트워크 주소, 0은 호스트 주소를 표시하고 & 연산으로 네트워크 주소를 알아낸다.<br>
보통 10진수로 ```255.0.0.0```, ```255.255.0.0```, ```255.255.255.0``` 와 같이 표현한다.<br>

![png](/_img/subnet_mask.png) <br>
> 출처 : IT 엔지니어를 위한 네트워크 입문 <br>

```103.9.32.0``` 주소에 서브넷 마스크가 ```255.255.0.0```을 사용하는 IP는 네트워크 주소가 ```103.9.32.0```이고, 호스트 주소는 ```0.0.0.146``` 이다.<br>

결국 서브넷 마스크에서 네트워크를 표현하는 1이 연속된다.<br>
즉, ```255.0.0.0```를 서브넷 마스크로 사용한다면 **/8**로 표기한다.<br><br>

## 서브네팅 subnetting

클래스 기반(클래스풀) 단위의 네트워크보다 더 쪼개 사용하는 것을 서브네팅이라고 한다. 부여된 주소를 다시 잘라 사용해 서브네팅이라 부르는데 클래스리스 네트워크의 가장 큰 특징이다.<br>

서브네팅에 대한 고민은 네트워크 설계자 입장과 사용자 입장으로 나눠 생각해야 한다.<br>

### 네트워크 사용자 입장

네트워크 범위 내에서 IP를 할당해야하고, 서브넷 마스크를 제대로 입력해야 로컬 네트워크의 특정 범위에 속해있는 단말과 문제되지 않으며 외부 네트워크 전체와 정상적인 통신이 가능하다.<br>

![png](/_img/subnetting1.png) <br>
> 출처 : IT 엔지니어를 위한 네트워크 입문 <br>

사용자가 네트워크를 파악하는 방법은 위 사진과 같다.<br>
IP 주소와 서브넷 마스크를 AND 연산해 서브네팅괸 네트워크 주소를 알아낸다.<br>

- 호스트 부분이 모두 0인 주소는 네트워크 주소이고
- 호스트 부분이 모두 1인 주소는 브로드캐스트 주소이다.

네트워크 주소와 브로드캐스트 주소사이에서 IP 주소를 사용하면 된다.<br><br>

![png](/_img/subnetting2.png) <br>
> 출처 : IT 엔지니어를 위한 네트워크 입문 <br>

### 네트워크 설계자 입장

네트워크 설계자는 네트워크 크기를 고민해 서브넷 마스트를 결정한다.<br>

- 서브넷된 하나의 네트워크에 IP를 몇 개나 할당해야 하는가.(또는 PC가 몇대나 있는가)
- 서브넷된 네트워크가 몇 개 필요한가

예를들어 회사에 총 12곳의 지사가 있으며, 각 지사들은 최대 12개의 IP가 필요하다.

- 서브넷된 하나의 네트워크에 각 지사가 필요한 12개의 IP와 네트워크 주소, 브로드캐스트 주소까지 총 14개의 IP 주소가 필요하다.
- 네트워크는 2진수 배수로 커지므로 16개짜리 네트워크를 할당한다. (실제 사용할 수 있는 IP는 네트워크, 브로드캐스트 주소를 제외한 14개)
- 총 12개의 지사가 있으므로 16개짜리 네트워크 12개를 확보한다.

현재 가진 네트워크가 103.9.32.0/24 일때 아래과 같이 16개짜리 네트워크 중 12개를 확보한다.<br>

![png](/_img/subnetting_admin.png) <br>
> 출처 : IT 엔지니어를 위한 네트워크 입문 <br>

<br>

## 공인 IP, 사설 IP

- 공인 IP : IP 주소가 전 세계에서 유일한 식별자
- 사설 IP : 인터넷에 접속하지 않거나 NAT(Network Address Translation) 기술을 사용하는 경우

사설 IP를 사용하면 인터넷에 직접 접속하지 못하지만 IP를 변환해주는 NAT 장비에서 공인 IP로 변경한 후 인터넷 접속이 가능하다. 우리가 가정에서 쓰는 공유기는 NAT 장비의 역할을 한다.<br>
회사 내부에서 사설 네트워크를 구축해 NAT를 이용해 인터넷에 연결한다 하더라도 다른 사용자에게 할당된 IP를 사용하면 안된다. 내부 네트워크에서 문제가 되기 때문이다.<br>

![png](/_img/private_ip.png) <br>
> 출처 : IT 엔지니어를 위한 네트워크 입문 <br>

A 회사는 ```20.0.0.0/24``` 네트워크를 사용하고, C 회사는 ```20.0.0.0/24``` 네트워크로 회사 내부의 사설 IP를 할당했다.<br>
C 회사는 ```20.0.0.10``` 서버에서 인터넷에서 서비스하는 A 회사의 ```20.0.0.20``` 서버로 접근을 시도할 경우 **같은 네트워크에 존재**하는 것으로 인식한다. 즉, 같은 네트워크로 인식되어 브로드캐스트가 진행되어 정상적인 통신이 불가능하다.<br>

![png](/_img/ip_address.png) <br>
> 출처 : IT 엔지니어를 위한 네트워크 입문 <br>

공인 IP는 인터넷에서 유일하게 사용되기 때문에 한정적이다. 공인 IP를 사용해 여유 없이 네트워크를 할당하면 크기가 다른 네트워크가 많아진다. 그럴 경우 관리가 힘들기 때문에 **같은 크기의 네트워크를 할당하고 10진수로 표현해도 쉽게 이해가 가능한 24비트 단위로 쪼개 할당(class C)** 하는 것을 추천한다.<br>

위 그림에서 왼쪽은 네트워크가 잘 설계된 경우다.<br>
라우터가 ```10.1.1.0/24```, ```10.1.2.0/24```, ```10.1.3.0/24``` 에 대한 네트워크를 관리하지만 Core는 ```10.1.0.0/16``` 네트워크 경로만 가지고 있으면 모든 ```10.1.X.0``` 네트워크로 패킷을 forwarding 할 수 있다.<br>

오른쪽의 경우 존재하는 네트워크 수만큼 Core 라우터가 모든 경로를 알고 있어야 하므로 관리가 어렵다.<br>
하지만 잘 설계된 왼쪽의 네트워크도 전체 성능이 향상되고 관리가 편한거지 IP 낭비가 심하다는 문제가 발생한다.<br>
라우터에 ```10.1.0.0/16``` 네트워크가 할당되었지만 실제로 3개만 사용하므로  2^8 = 256개 중 253개는 사용하지 못해 낭비된다.<br>
이런 문제를 해결하기 위해 사설 IP로 네트워크를 설계한다.
