PRG(Post-Redirect-Get) 패턴은 웹 개발에 권장되는 디자인 패턴 중 하나로, 원리는 다음과 같다.

1. 클라이언트는 HTTP POST 요청을 한다.
2. 서버는 요청에 대한 응답으로 **지정한 URL 과 GET 방식으로 redirect 되는 302 상태**를 설정한다.
3. 자동 리다이렉션을 통해 서버가 설정한 URL에 접근하게 된다.

즉, HTTP POST 요청에 대한 응답을 **지정한 URL**과 **GET 요청**으로 설정하기 위한 패턴을 PRG(Post-Redirect-Get) 패턴이라고 한다.

## PRG 패턴 적용전

POST 요청에 대해 PRG 패턴을 적용하지 않으면 발생되는 문제는 다음과 같다.

![png](/Design-pattern/_img/before_applying_prg_pattern.png)

- 클라이언트에서 사과 2개를 주문하는 POST 요청을 서버에게 보냈다.
- 서버는 해당 데이터를 DB에 저장한 뒤, 잘 처리했다는 200 OK 상태를 응답으로 보낸다.
- 200 OK 응답을 받은 클라이언트의 화면에는 여전히 주문하는 페이지가 보여지고있다.

이 상태에서 url 새로고침을 하게 되면 이전에 주문했던 사과 2개를 다시 POST 요청되는 상황이 발생된다. 서버는 또 다시 사과 2개 주문을 DB에 저장해 동일한 클라이언트가 사과 4개를 주문한 것으로 처리된다.

이런 경우를 방지하고자 PRG 패턴을 적용한다.

## PRG 패턴 적용후

배달 어플로 주문을 하면 주문 결과창을 볼 수 있는 이유는 PRG 패턴이 적용된 상태이기 때문이다.

![png](/Design-pattern/_img/apply_prg_pattern.png)

주문후 url 새로고침으로 인한 재주문을 막기 위해 POST 요청에 대한 응답에 http 302 상태와 Location 헤더에 응답에 대한 결과창 url을 작성한다.

http 302 상태 코드는 redirect시 요청 메소드를 GET으로 변경시키므로 Location 헤더에 작성된 url로 자동 리다이렉션된다.

즉, 주문 요청에 대한 응답을 302 상태코드와 Location 헤더에 주문에 대한 결과창 url로 작성했다면, 주문 요청시 응답에 대해 자동 라다이렉션되어 주문 결과창이 보여진다. 주문 결과창을 노출시키는 GET 방식이므로 계속해서 url 새로고침해도 재주문되는 문제를 막을 수 있다.

잘못된 요청을 서버 측에서 무조건 막도록 설정해야 하지만 PRG 패턴을 통해 클라이언트 측에서 잘못된 요청을 한번 더 막아주면 사용성이 좋이지며 오류가 줄어든다.
