# OSI 7 계층 (Open Systems Interconnection Reference Model)

![png](/Network/_img/osi7.png)

- Open Systems Interconnection Reference Model
- 국제표준화기구(ISO)에서 개발한 모델로 컴퓨터 네트워크 프로토콜 디자인과 통신을 계층으로 나누어 설명
- 즉, 네트워크에서 통신이 일어나는 과정을 7단계로 나눔
- 나눈 이유는 통신이 일어나는 과정을 단계별로 알고, 문제가 생길 시 해당 단계만 수정
- 현재 인터넷은 각 계층의 역할이 합쳐지면서 TCP/IP 4계층 모델을 기반함
- Application 계층인 5, 6, 7 계층은 개발자가 구현
  - 소켓 기반으로 응용프로그램의 프로토콜을 구성하는 계층
  - 소켓을 생성하면 하위 계층의 내용이 감춰짐 
- Data flow 계층인 1 ~ 4 계층은 OS에서 설정
<br>

## 1계층: Physical layer

- 데이터를 주고 받을 물리적 매체와 관련된 기능 제공
- 1계층에서 사용되는 통신단위는 비트: ```1(on)```, ```0(off)```
- 해당 매체의 전기적 특성을 특성을 사용해서 데이터를 주고 받음
- 예를 들면 radio 전송 방식을 사용하면 공기 중에서 전기적 특성을 통해 데이터를 주고 받음
  - 공기 중에서의 통신에는 외부적인 요소로 인해 많은 에러가 발생해 데이터 전송을 보장할 수 없음
  - 공기 매체로 전송 시 ```A -> B``` , ```C -> D``` 의 전송이 서로 간접되지 않아야 함 -> Data link 계층에서 MAC (Media Access Control) 으로 설정
  - 즉, 신뢰성 있는 데이터 전송을 위해 상위계층이 필요하다.
- 주소의 개념이 없어 전기 신호가 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 전송
<br>
  
## 2계층: Data link layer

- P2P 통신으로 **다이렉트로 연결된 인접한** 스테이션간의 신뢰성 있는 통신을 보장 -> **end to end 가 아님**
- LAN, WAN, MAN 과 같은 물리적인 네트워크 표준 관련 프로토콜이 정의
- 물리계층에서 받은 정보를 bridge, switch 장비 통해 MAC 주소로 전달
- 물리 계층을 통해 송수신하는 데이터의 오류와 흐름을 관리
  - 통신에서의 오류를 찾고 재전송하는 기능이 존재
- error control(correction) : 오지 않는 데이터를 다시 요구
- 2계층부터 주소 체계가 생겼으며 이는 동시에 여러 명과 통신할 수 있다는 것으로 받는 사람이 현재 데이터를 받을 수 있는지 확인하는 작업부터 수행하며 이 작업을 Flow Control이라고 함
- MAC(media access control) : 공기 중 통신에서 여러 P2P 간의 통신이 서로 간섭되는 것을 방지
  - 이 마저도 외부요인으로 실패한다면 error control

### MAC (Media Access Control)

- 네트워크 세그먼트의 데이터 링크 계층에서 통신을 위한 **네트워크 인터페이스에 할당된 고유 식별자**
- NIC(Network Interface Controller): 컴퓨터를 네트워크에 연결하여 통신하기 위해 사용하는 하드웨어 장치
  - network card, LAN card, network adapter... 모두 같은 용어
- MAC 주소는 NIC 제조업체가 할당하며 하드웨어에 저장
- 하나의 네트워크 노드는 여러개의 NIC 를 가질 수 있고, 각 NIC 는 고유한 MAC 주소 할당 
- MAC 주소는 단말에 종속되지 않고 NIC에 종속
- 단말은 여러개의 NIC가질 수 있으므로 MAC 주소도 여러개 가질 수 있다.
- 멀티레이어 스위치, 라우터와 같은 복잡한 네트워크 장비는 NIC가 여러개이고 MAC 주소도 여러개이다.
<br>

- NIC(Network Interface Card) 동작방식은 다음과 같다.
- 전기 신호를 데이터 형태로 만든다.
- 목적지 MAC 주소와 네트워크 인터페이스 카드의 MAC 주소를 확인한다.
- 서로의 주소가 일치하면 데이터를 처리하고 그렇지 않을 경우 데이터를 폐기한다.
<br>

- 스위치 : 여러개의 access point 를 한개의 선으로 전송
- Gateway : 여러개의 스위치를 1개의 선으로 내보내며 외부 인터넷과 연결시키는 기능 (다른 네트워크로 들어가는 입구 역할을 하는 네트워크 포인트)
- 네트워크 : 여러개의 스위치가 연결된 것
- 인터넷 : 여러개의 네트워크가 모여있는 것
- 라우터 : input/output 선이 여러개이므로 데이터를 어느 output 으로 내보내야 하는지 결정해 전송
- Internet core : 라우터의 집합 (각 네트워크로 이루어진 여러 인터넷은 라우터로 이루어짐)
<br>
  
## 3계층: Network layer

- 네트워크를 거쳐 원하는 목적지까지의 연결성 제공 
- 수많은 경로 중 라우터가 최적의 경로를 선택해 목적지까지의 전송을 제공
- 데이터 링크 계층(2)의 하드웨어적인 특성과 관계없이 독립적인 역할을 수행
- IP 주소와 같은 논리적인 주소가 정의되고 데이터를 통신할 때 2계층의 물리적인 MAC 주소와 3계층의 논리적인 IP 주소를 사용한다.

### IP 계층

- end to end 간의 경로를 탐색 -> Routing
- TCP/IP 상에서 IP 계층은 IP 주소(네트워크 주소)를 정의하고
- IP 패킷의 전달 및 라우팅을 담당하는 계층
- 데이터 링크 계층(2)의 하드웨어적인 특성과 관계없이 독립적인 역할을 수행

### IP protocol

- IP 계층에서 IP 패킷의 routing 대상이 됨
- IP 주소 지정: Addressing
- 신뢰성(에러제어), 흐름제어 같은 기능이 없음
  - 신뢰성을 확보하려면 4계층 TCP 에 의존해야함
- 비연결성 데이터그램 방식으로 전달되는 프로토콜
- 패킷의 소실, 중복, 지연, 순서 보장을 보장하지 않음
- Big-endian 방식으로 MSB 먼저 보냄
<br>

## 4계층: Transport layer

- 2, 3계층은 목적지를 정확하게 찾아가기 위한 주소 제공이 목적
- 4계층은 목적지 단말 안에서 동작하는 여러 애플리케이션 프로세스 중 통신해야 할 목적지 프로세스를 정확히 찾아가고, 패킷 순서가 바뀌지 않도록 조합해 데이터를 잘 만들어내는 것이 목적
  - 목적지 프로세스를 찾는다 -> 포트번호가 일치하는 소켓을 찾는다.
  - 패킷 순서가 바뀌지 않도록 조합한다 -> Sequence Number, Acknowledgement Number 
- 즉, end to end 간의 신뢰성 있는 통신을 보장
- 상위 계층에서 데이터의 유효성, 효율성을 신경쓰지 않게 해줌
- 패킷 네트워크는 데이터를 분할해 패킷에 실어보내다 보니 중간에 패킷이 유실되거나 순서가 바뀔 수 있는데 바로잡아 주는 역할을 4계층에서 한다.
- Sequence Number로 패킷을 보낸 순서를 명시하고, Acknowledgement Number에 받는 순서를 나타낸다.
- 오류 복구, 흐름 제어, 중복 검사 등의 기능 존재
- 전송 계층은 패킷들의 전송이 유효한지 확인하고 전송 실패한 패킷을 다시 전송
- TCP, UDP 를 주로 사용

### TCP

- 소켓간 신뢰성 있는 연결지향성 서비스 제공
- reliable 신뢰성: 패킷 손실 중복, 순서 바뀜이 일어나지 않도록 보장
- connection-oriented 연결지향적: 목적지와 연결되면 그 이후에는 데이터만 보내면 됨

### UDP

- 비연결성이므로 데이터를 보낼 때마다 목적지를 설정해야함

<br>

## 5계층: Session layer

- 양 끝단의 응용 프로세스가 연결을 성립하도록 도와주고 연결이 안정적으로 유지되도록 관리
- 데이터가 통신하기 위한 논리적 연결로 데이터 교환의 경계와 동기화를 제공
- end to end 의 응용 프로세스가 통신을 관리하기 위한 방법 제공
- 4계층에서도 서로의 연결을 확인하지만 4계층과 무관하게 **응용 프로그램 관점에서** 연결을 확인함

<br>

## 6계층: Presentation layer

- 표현 방식이 다른 애플리케이션이나 시스템 간의 통신을 돕기 위해 하나의 통일된 구문 형식으로 변환
- 7계층에서 교환되는 데이터의 형식 차이를 처리 (데이터 표현에 대한 독립성 제공)
- 데이터가 text, jpg, gif 인지 구분
- MIME 인코딩이나 암호화, 압축, 코드 변환 같은 동작을 수행
<br>

## 7계층: Application layer

- 통신의 최종 목적지로 애플리케이션 프로세스를 정의하고 애플리케이션 서비스를 수행
- 모든 통신의 양 끝단은 HTTP 같은 프로토콜
- 최종 목적지로 HTTP, FTP, SMTP, POP3, IMAP 등과 같은 프로토콜 존재

### HTTP (HyperText Transfer Protocol)

- 웹서버 및 웹브라우저 간의 데이터 전송을 위한 protocol
- 과거에는 비트로만 전달했기 때문에 데이터 형식에 제한이 있었지만
- 현재는 이미지, 비디오, 음성 등 모든 형식에 대한 데이터 전송이 가능